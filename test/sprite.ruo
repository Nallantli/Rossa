load "sdl.ruo";

w := new Window("Sprite Clipping", 512, 512);
r := w.getRenderer();
rand := new Random();

spritesheet := new SDL.Image("docs/curses12x12.png", Color.MAGENTA);

tiles := alloc(256);

for x in 0 .. 16 do {
	for y in 0 .. 16 do {
		tiles[x * 16 + y] = new SDL.Texture(spritesheet, 32, 32);
		tiles[x * 16 + y].clip(x * 12, y * 12, 12, 12);
	}
}

randomize() => {
	for x in 0 .. 16 do {
		for y in 0 .. 16 do {
			r.put(tiles[rand.nexti(0, 255)], x * 32, y * 32);
		}
	}
	r.flush();
}

randomize();

var e;
while (e = Event.poll()).type != Event.QUIT do {
	if e.type == Event.KEY_DOWN then {
		if e.keysym.sym == ' ' then {
			randomize();
		}
	}
}